services:
  database:
    image: ghcr.io/whit3str/mangos0server-database:latest
    container_name: mangos-database
    environment:
      MYSQL_ROOT_PASSWORD: mangos
    volumes:
      - ./db:/var/lib/mysql
    ports:
      - "3306:3306"
    networks:
      - mangos-net
    healthcheck:
      test: ["CMD-SHELL", "mysqladmin ping -h localhost -u root -pmangos && mysql -u root -pmangos -e 'SELECT 1 FROM realmd.realmlist LIMIT 1;' 2>/dev/null"]
      interval: 15s
      timeout: 10s
      retries: 20
      start_period: 180s

  realmd:
    image: ghcr.io/whit3str/mangos0server-realmd:latest
    container_name: mangos-realmd
    depends_on:
      database:
        condition: service_healthy
    ports:
      - "3724:3724"
    volumes:
      - ./config/realmd.conf:/mangos/etc/realmd.conf
      - ./logs:/mangos/log
    networks:
      - mangos-net
    stdin_open: true
    tty: true
    restart: unless-stopped

  mangosd:
    image: ghcr.io/whit3str/mangos0server-mangosd:latest
    container_name: mangos-mangosd
    depends_on:
      database:
        condition: service_healthy
      realmd:
        condition: service_started
    ports:
      - "8085:8085"
    volumes:
      - ./config/mangosd.conf:/mangos/etc/mangosd.conf
      - ./logs:/mangos/log
      - ./wow-data:/mangos/share/mangos
    networks:
      - mangos-net
    stdin_open: true
    tty: true
    restart: unless-stopped

networks:
  mangos-net:
